<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Přidání vozidla</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .header {
            background-color: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }
        .form-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .logout-btn {
            background-color: #f44336;
            color: white;
            border: none;
            cursor: pointer;
        }
        .add-vehicle-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            padding: 10px;
            margin: 20px 0;
        }
        .image-preview {
            margin-top: 10px;
            max-width: 300px;
            max-height: 300px;
            object-fit: cover;
        }
        .vehicle-item {
            padding: 20px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fafafa;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .vehicle-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            margin-right: 20px;
        }
        .vehicle-item-details {
            flex: 1;
        }
        .vehicle-item button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .vehicle-item button.edit-btn {
            background-color: #ffa500;
        }
        .vehicle-list {
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Admin Panel</h1>
    </div>

    <!-- Přihlašovací formulář -->
    <div id="login-form" class="form-container">
        <h3>Přihlášení</h3>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Heslo">
        <button onclick="login()">Přihlásit se</button>
        <p id="login-error" style="color: red; display: none;">Chyba při přihlášení. Zkontrolujte své údaje.</p>
    </div>

    <!-- Sekce pro přidání vozidla -->
    <div id="add-vehicle-section" class="form-container hidden">
        <h3>Přidat nové vozidlo</h3>
        <form id="vehicle-form">
            <input type="text" id="vehicle-name" placeholder="Název vozidla (make, model)">
            <input type="text" id="vehicle-vin" placeholder="VIN číslo">
            <input type="text" id="vehicle-price" placeholder="Cena vozidla">
            <input type="text" id="vehicle-photo-url" placeholder="URL obrázku vozidla">
            <!-- Přidané druhé pole pro URL druhé fotografie -->
            <input type="text" id="vehicle-second-photo-url" placeholder="URL druhé fotografie vozidla"> <!-- Druhé pole -->
            <!-- Přidané pole pro úpravy vozidla -->
            <textarea id="vehicle-modifications" placeholder="Úpravy vozidla" rows="4"></textarea>
            <img id="image-preview" class="image-preview" src="" alt="Náhled fotky" style="display:none;">
            <button type="button" onclick="submitVehicle()">Přidat vozidlo</button>
        </form>

        <div class="vehicle-list" id="vehicle-list">
            <!-- Seznam vozidel se načte sem -->
        </div>
    </div>

    <button id="logout-btn" class="logout-btn hidden" onclick="logout()">Odhlásit se</button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>

    <script>
        // Inicializace Firebase na začátku
        const firebaseConfig = {
            apiKey: "AIzaSyA5HS8DAx-agVLBrsfVPiv5i1oKzwzvUTE",
            authDomain: "bazar-39aac.firebaseapp.com",
            projectId: "bazar-39aac",
            storageBucket: "bazar-39aac.firebasestorage.app",
            messagingSenderId: "960204577980",
            appId: "1:960204577980:web:12f4ca5eb7563fa71204b9",
            measurementId: "G-H2DW7KXGL4"
        };

        // Inicializace aplikace Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        } else {
            firebase.app();  // Pokud je Firebase již inicializováno, použije se existující instance
        }

        // Inicializace Auth a Firestore
        const auth = firebase.auth();
        const db = firebase.firestore();
        const analytics = firebase.analytics();
// Funkce pro formátování ceny
function formatPriceInput(event) {
    let value = event.target.value.replace(/\./g, ''); // Odstraní všechny tečky
    if (!value) return; // Pokud je prázdné, neprovádíme žádnou změnu

    // Formátování čísla s tečkami pro tisíce
    value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    
    event.target.value = value; // Nastaví hodnotu zpět do pole
}

// Přidání události pro formátování při zadávání
document.getElementById('vehicle-price').addEventListener('input', formatPriceInput);

        // Funkce pro přihlášení
        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("Přihlášen:", user.email);
                    showAdminSection(); // Zobrazí admin sekci po přihlášení
                })
                .catch((error) => {
                    console.error("Chyba při přihlášení:", error.message);
                    document.getElementById("login-error").style.display = "block"; // Zobrazí chybovou zprávu
                });
        }

        // Funkce pro zobrazení administrativní sekce
        function showAdminSection() {
            document.getElementById("login-form").style.display = "none"; // Skryje login form
            document.getElementById("add-vehicle-section").style.display = "block"; // Zobrazí sekci pro přidání vozidla
            document.getElementById("logout-btn").style.display = "block"; // Zobrazí tlačítko pro odhlášení
            loadVehicleList(); // Načte seznam vozidel
        }

        // Funkce pro přidání vozidla do Firestore
        function submitVehicle() {
            const name = document.getElementById("vehicle-name").value;
            const vin = document.getElementById("vehicle-vin").value;
            const price = document.getElementById("vehicle-price").value;
            const photoURL = document.getElementById("vehicle-photo-url").value;
            const secondPhotoURL = document.getElementById("vehicle-second-photo-url").value; // URL druhé fotografie
            const modifications = document.getElementById("vehicle-modifications").value; // Úpravy vozidla

            if (name && vin && price && photoURL && secondPhotoURL && modifications) {
                db.collection("vehicles").add({
                    name: name,
                    vin: vin,
                    price: price,
                    photoURL: photoURL, // Uložíme URL fotografie
                    secondPhotoURL: secondPhotoURL, // Uložíme URL druhé fotografie
                    modifications: modifications // Uložíme úpravy vozidla
                }).then(() => {
                    console.log("Vozidlo přidáno");
                    alert("Vozidlo bylo úspěšně přidáno.");
                    document.getElementById("vehicle-form").reset();  // Resetuje formulář po přidání vozidla
                    document.getElementById("image-preview").style.display = "none";  // Skryje náhled fotky
                    loadVehicleList();  // Načte seznam vozidel znovu
                }).catch((error) => {
                    console.error("Chyba při přidávání vozidla:", error);
                    alert("Došlo k chybě při přidávání vozidla.");
                });
            } else {
                alert("Vyplňte všechny údaje.");
            }
        }

        // Funkce pro mazání vozidla
        function deleteVehicle(vehicleId) {
            const confirmDelete = confirm("Opravdu chcete toto vozidlo smazat?");
            if (confirmDelete) {
                db.collection("vehicles").doc(vehicleId).delete().then(() => {
                    console.log("Vozidlo smazáno");
                    loadVehicleList();  // Po smazání znovu načteme seznam vozidel
                }).catch((error) => {
                    console.error("Chyba při mazání vozidla:", error);
                });
            }
        }

        // Funkce pro editaci vozidla
        function editVehicle(vehicleId) {
            const vehicleRef = db.collection("vehicles").doc(vehicleId);
            vehicleRef.get().then((doc) => {
                if (doc.exists) {
                    const vehicle = doc.data();
                    document.getElementById("vehicle-name").value = vehicle.name;
                    document.getElementById("vehicle-vin").value = vehicle.vin;
                    document.getElementById("vehicle-price").value = vehicle.price;
                    document.getElementById("vehicle-photo-url").value = vehicle.photoURL;
                    document.getElementById("image-preview").src = vehicle.photoURL;
                    document.getElementById("image-preview").style.display = "block";
                    document.getElementById("vehicle-form").onsubmit = function() {
                        // Aktualizace vozidla v databázi
                        vehicleRef.update({
                            name: document.getElementById("vehicle-name").value,
                            vin: document.getElementById("vehicle-vin").value,
                            price: document.getElementById("vehicle-price").value,
                            photoURL: document.getElementById("vehicle-photo-url").value
                        }).then(() => {
                            alert("Vozidlo bylo úspěšně aktualizováno.");
                            loadVehicleList(); // Načte seznam vozidel znovu
                        }).catch((error) => {
                            console.error("Chyba při aktualizaci vozidla:", error);
                        });
                    };
                }
            });
        }

        // Načítání seznamu vozidel z Firestore
        function loadVehicleList() {
            const vehiclesContainer = document.getElementById("vehicle-list");
            vehiclesContainer.innerHTML = "";  // Vyčistí seznam před načítáním

            db.collection("vehicles").get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const vehicle = doc.data();
                    const vehicleDiv = document.createElement("div");
                    vehicleDiv.classList.add("vehicle-item");
                    vehicleDiv.innerHTML = `
                        <div class="vehicle-item-details">
                            <strong>${vehicle.name}</strong><br>
                            VIN: ${vehicle.vin}<br>
                            Cena: ${vehicle.price} CZK
                        </div>
                        <div>
                            <button onclick="editVehicle('${doc.id}')" class="edit-btn">Úprava</button>
                            <button onclick="deleteVehicle('${doc.id}')">Smazat vozidlo</button>
                        </div>
                    `;
                    if (vehicle.photoURL) {
                        const img = document.createElement("img");
                        img.src = vehicle.photoURL;
                        vehicleDiv.appendChild(img);
                    }
                    vehiclesContainer.appendChild(vehicleDiv);
                });
            }).catch((error) => {
                console.error("Chyba při načítání vozidel:", error);
            });
        }

        // Odhlášení
        function logout() {
            auth.signOut().then(() => {
                console.log("Uživatel byl odhlášen.");
                document.getElementById("login-form").style.display = "block"; // Zobrazí login form
                document.getElementById("add-vehicle-section").style.display = "none"; // Skryje sekci pro přidání vozidla
                document.getElementById("logout-btn").style.display = "none"; // Skryje tlačítko pro odhlášení
            }).catch((error) => {
                console.error("Chyba při odhlášení:", error.message);
            });
        }

        // Automatické zobrazení přihlášeného uživatele
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                showAdminSection(); // Pokud je uživatel přihlášen, zobrazí admin sekci
            } else {
                document.getElementById("login-form").style.display = "block"; // Zobrazí login form
                document.getElementById("add-vehicle-section").style.display = "none"; // Skryje sekci pro přidání vozidla
                document.getElementById("logout-btn").style.display = "none"; // Skryje tlačítko pro odhlášení
            }
        });
    </script>

</body>
</html>
